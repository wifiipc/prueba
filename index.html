<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para ti ‚ù§Ô∏è</title>
    <style>
        /* --- FUENTES --- */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Dancing+Script:wght@700&family=Pacifico&display=swap');

        /* --- ESTILOS GENERALES --- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Montserrat', sans-serif;
            color: white;
            height: 100vh;
            width: 100vw;
            perspective: 1000px;
        }

        /* --- BOTONES --- */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .btn-glass {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: white;
            border-radius: 30px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            font-size: 0.9rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        .btn-glass:hover {
            background: #ff4d6d;
            border-color: #ff4d6d;
            transform: scale(1.05);
        }

        /* --- ESCENAS --- */
        .escena {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease, transform 1s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(1.2);
        }

        .activa {
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
        }

        /* --- ESCENA 1: UNIVERSO --- */
        #universo { background: black; }
        #starCanvas { position: absolute; z-index: 1; }
        #contenido-texto {
            position: relative;
            z-index: 10;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: #ff4d6d;
            text-shadow: 0 0 20px #ff4d6d;
            margin: 0;
        }
        #maquina-escribir {
            font-size: 1.5rem;
            color: #eee;
            min-height: 1.5em;
        }

        /* --- ESCENA 2: EL √ÅRBOL (CORREGIDO) --- */
        #jardin {
            /* Fondo Atardecer Rom√°ntico (No negro) */
            background: linear-gradient(to bottom, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            flex-direction: column;
            overflow: hidden;
        }
        canvas#arbolCanvas { 
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2; 
        }
        .mensaje-arbol {
            position: absolute;
            bottom: 30px;
            z-index: 10;
            text-align: center;
            font-family: 'Pacifico', cursive;
            font-size: 2.5rem;
            color: #fff;
            text-shadow: 0 2px 5px rgba(255, 77, 109, 0.8);
            opacity: 0;
            animation: aparecer 2s ease-in 3s forwards;
            background: rgba(255, 77, 109, 0.3);
            padding: 10px 30px;
            border-radius: 50px;
        }

        /* --- ESCENA 3: CARTA SORPRESA (NUEVO) --- */
        #carta-scene {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-direction: column;
        }
        
        .sobre-container {
            position: relative;
            width: 300px;
            height: 200px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .sobre-container:hover { transform: scale(1.05); }

        .sobre {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #ff4d6d;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 5;
            overflow: hidden;
        }
        .solapa {
            position: absolute;
            top: 0;
            left: 0;
            width: 0; 
            height: 0; 
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 100px solid #ff758c;
            transform-origin: top;
            transition: transform 0.6s 1s; /* Retraso para que salga la carta */
            z-index: 6;
        }
        .carta-papel {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 280px;
            height: 180px;
            background: white;
            border-radius: 5px;
            padding: 20px;
            box-sizing: border-box;
            font-family: 'Dancing Script', cursive;
            font-size: 1.2rem;
            color: #333;
            text-align: center;
            transition: transform 1s ease-in-out;
            z-index: 4;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 -5px 10px rgba(0,0,0,0.1);
        }
        
        /* Animaci√≥n Carta Abierta */
        .abrir-sobre .solapa { transform: rotateX(180deg); transition: transform 0.6s; z-index: 1;}
        .abrir-sobre .carta-papel { transform: translateY(-150px); z-index: 10; transition: transform 1s 0.6s; }
        
        .click-hint {
            margin-top: 50px;
            color: white;
            font-size: 0.9rem;
            animation: blink 2s infinite;
        }

        /* --- ESCENA 4: CORAZ√ìN 3D --- */
        #corazon-scene {
            background: radial-gradient(circle, #1a0b14 0%, #000000 100%);
            flex-direction: column;
            overflow: hidden;
        }
        #heartCanvas { position: absolute; z-index: 1; }
        .titulo-flotante {
            position: absolute;
            top: 15%;
            font-family: 'Pacifico', cursive;
            font-size: 3rem;
            color: #ff99ac;
            text-shadow: 0 0 20px #ff006e;
            z-index: 10;
            animation: flotar 3s ease-in-out infinite;
        }

        /* --- ESCENA 5: CARRUSEL --- */
        #galeria {
            background: #000;
            overflow: hidden;
        }
        .carousel-container {
            position: relative;
            width: 200px;
            height: 300px;
            transform-style: preserve-3d;
            animation: rotarCarrusel 20s infinite linear;
        }
        .carousel-container:hover { animation-play-state: paused; }
        .foto-card {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.1);
            border: 2px solid #ff4d6d;
            border-radius: 10px;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(255, 77, 109, 0.5);
            backface-visibility: hidden; /* Mejor rendimiento */
        }
        .foto-card img { width: 100%; height: 100%; object-fit: cover; }

        /* ANIMACIONES */
        @keyframes rotarCarrusel { from { transform: perspective(1000px) rotateY(0deg); } to { transform: perspective(1000px) rotateY(360deg); } }
        @keyframes flotar { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes aparecer { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .cursor { display: inline-block; width: 2px; height: 1.2em; background: white; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

    </style>
</head>
<body>

    <div class="controls">
        <button id="btn-music" class="btn-glass" onclick="toggleMusic()">üéµ M√∫sica</button>
        <button id="btn-next" class="btn-glass" onclick="siguienteEscena()">Siguiente ‚û°Ô∏è</button>
    </div>

    <audio id="bg-music" loop>
        <source src="tu_cancion.mp3" type="audio/mpeg">
    </audio>

    <div id="universo" class="escena activa">
        <canvas id="starCanvas"></canvas>
        <div id="contenido-texto">
            <h1>Para mi Amor</h1>
            <div><span id="maquina-escribir"></span><span class="cursor"></span></div>
        </div>
    </div>

    <div id="jardin" class="escena">
        <canvas id="arbolCanvas"></canvas>
        <div class="mensaje-arbol">
            Nuestro Amor Florece
        </div>
    </div>
    
    <div id="carta-scene" class="escena">
        <div class="sobre-container" id="sobre" onclick="abrirCarta()">
            <div class="sobre"></div>
            <div class="solapa"></div>
            <div class="carta-papel">
                "Cada d√≠a a tu lado es un regalo.<br>Gracias por ser t√∫.<br>Te Amo."
            </div>
        </div>
        <div class="click-hint">üëá Haz clic en el sobre üëá</div>
    </div>

    <div id="corazon-scene" class="escena">
        <div class="titulo-flotante">Eres mi Todo</div>
        <canvas id="heartCanvas"></canvas>
    </div>

    <div id="galeria" class="escena">
        <div class="titulo-flotante" style="top: 10%; font-size: 2.5rem;">Nuestros Recuerdos</div>
        <div class="carousel-container" id="carousel">
            </div>
    </div>

    <script>
        /* =========================================
           CONFIGURACI√ìN
           ========================================= */
        const FRASES = ["Eres mi universo.", "Mi casualidad favorita.", "Te amo infinito."];
        const FOTOS = [
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+1",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+2",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+3",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+4",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+5"
        ];

        let escenaActual = 0;
        const escenasIds = ['universo', 'jardin', 'carta-scene', 'corazon-scene', 'galeria'];

        function siguienteEscena() {
            document.getElementById(escenasIds[escenaActual]).classList.remove('activa');
            escenaActual = (escenaActual + 1) % escenasIds.length;
            const nueva = document.getElementById(escenasIds[escenaActual]);
            nueva.classList.add('activa');
            
            // L√≥gica por escena
            const btn = document.getElementById('btn-next');
            if(escenaActual === 0) { btn.innerText = "Ver √Årbol üå≥"; initStars(); animateStars(); }
            else if(escenaActual === 1) { btn.innerText = "Ver Carta üíå"; initTree(); } // √Årbol
            else if(escenaActual === 2) { btn.innerText = "Ver Coraz√≥n üíñ"; } // Carta
            else if(escenaActual === 3) { btn.innerText = "Ver Fotos üì∏"; initHeart(); animateHeart(); }
            else { btn.innerText = "Inicio ‚ú®"; crearCarrusel(); }
        }

        function toggleMusic() {
            const audio = document.getElementById('bg-music');
            audio.paused ? audio.play() : audio.pause();
        }
        
        function abrirCarta() {
            document.getElementById('sobre').classList.toggle('abrir-sobre');
        }

        /* =========================================
           1. UNIVERSO
           ========================================= */
        const starCanvas = document.getElementById('starCanvas');
        const sCtx = starCanvas.getContext('2d');
        let stars = [];

        function initStars() {
            starCanvas.width = window.innerWidth; starCanvas.height = window.innerHeight;
            stars = [];
            for(let i=0; i<300; i++) stars.push({x:Math.random()*starCanvas.width, y:Math.random()*starCanvas.height, z:Math.random()*starCanvas.width});
        }
        function animateStars() {
            if(!document.getElementById('universo').classList.contains('activa')) return;
            sCtx.fillStyle = "black"; sCtx.fillRect(0,0,starCanvas.width, starCanvas.height);
            sCtx.fillStyle = "white";
            stars.forEach(s => {
                s.z -= 2; if(s.z <= 0) s.z = starCanvas.width;
                let x = (s.x-starCanvas.width/2)*(starCanvas.width/s.z)+starCanvas.width/2;
                let y = (s.y-starCanvas.height/2)*(starCanvas.width/s.z)+starCanvas.height/2;
                if(x>0 && x<starCanvas.width && y>0 && y<starCanvas.height) { sCtx.beginPath(); sCtx.arc(x,y,(1-s.z/starCanvas.width)*3,0,Math.PI*2); sCtx.fill(); }
            });
            requestAnimationFrame(animateStars);
        }

        /* =========================================
           2. √ÅRBOL CORREGIDO (FRONDOSO Y SIN DERRETIRSE)
           ========================================= */
        const treeCanvas = document.getElementById('arbolCanvas');
        const tCtx = treeCanvas.getContext('2d');
        let treeW, treeH;

        function initTree() {
            treeW = treeCanvas.width = window.innerWidth;
            treeH = treeCanvas.height = window.innerHeight;
            tCtx.clearRect(0,0,treeW,treeH);
            // Dibujar desde abajo
            drawBranch(treeW/2, treeH, 130, -90, 25, 0); 
        }

        function drawBranch(x, y, len, angle, width, depth) {
            setTimeout(() => {
                if(!document.getElementById('jardin').classList.contains('activa')) return;
                
                tCtx.beginPath();
                tCtx.moveTo(x, y);
                const endX = x + len * Math.cos(angle * Math.PI/180);
                const endY = y + len * Math.sin(angle * Math.PI/180);
                
                tCtx.lineTo(endX, endY);
                // Color marr√≥n oscuro para contraste con fondo rosa
                tCtx.strokeStyle = `hsl(25, ${80-depth*5}%, ${15+depth*2}%)`;
                tCtx.lineWidth = width;
                tCtx.lineCap = "round";
                tCtx.stroke();

                // DIBUJAR HOJAS (CORAZONES)
                // Dibujamos corazones no solo al final, sino en ramas medias para que sea abundante
                if (depth > 6) {
                    // Dibujar varios corazones alrededor del punto final para dar volumen
                    for(let i=0; i<3; i++) {
                        tCtx.beginPath();
                        // Colores rojos y rosas intensos
                        tCtx.fillStyle = `hsl(${340 + Math.random()*20}, 100%, ${50 + Math.random()*20}%)`; 
                        tCtx.font = `${15 + Math.random()*15}px Arial`;
                        // Posici√≥n aleatoria peque√±a alrededor del fin de rama
                        let offsetX = (Math.random()-0.5) * 20;
                        let offsetY = (Math.random()-0.5) * 20;
                        tCtx.fillText("‚ù§Ô∏è", endX + offsetX - 8, endY + offsetY + 8);
                    }
                }

                if (depth < 11) { // L√≠mite de recursividad
                    const subLen = len * 0.75;
                    const subWidth = width * 0.7;
                    // Ramificaci√≥n
                    drawBranch(endX, endY, subLen, angle - 20 - Math.random()*15, subWidth, depth + 1);
                    drawBranch(endX, endY, subLen, angle + 20 + Math.random()*15, subWidth, depth + 1);
                }

            }, 50 * depth); // Velocidad de crecimiento
        }

        /* =========================================
           3. CORAZ√ìN 3D
           ========================================= */
        const hCanvas = document.getElementById('heartCanvas');
        const hCtx = hCanvas.getContext('2d');
        let hPoints = []; let angleY = 0;

        function initHeart() {
            hCanvas.width = window.innerWidth; hCanvas.height = window.innerHeight;
            hPoints = [];
            for(let i=0; i<1500; i++) {
                let t = Math.random()*Math.PI*2, x = 16*Math.pow(Math.sin(t),3), y = -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
                let z = (Math.random()-0.5)*10;
                hPoints.push({x:x*12, y:y*12, z:z*12, color: `hsl(${330+Math.random()*40}, 90%, 60%)`});
            }
        }
        function animateHeart() {
            if(!document.getElementById('corazon-scene').classList.contains('activa')) return;
            hCtx.fillStyle = "rgba(0,0,0,0.2)"; hCtx.fillRect(0,0,hCanvas.width, hCanvas.height);
            angleY += 0.01;
            let cx = hCanvas.width/2, cy = hCanvas.height/2;
            hPoints.forEach(p => {
                let rx = p.x*Math.cos(angleY) - p.z*Math.sin(angleY);
                let rz = p.x*Math.sin(angleY) + p.z*Math.cos(angleY);
                let scale = 500/(500+rz);
                if(scale>0) {
                    hCtx.fillStyle = p.color; hCtx.beginPath(); hCtx.arc(rx*scale+cx, p.y*scale+cy, 2*scale, 0, Math.PI*2); hCtx.fill();
                }
            });
            requestAnimationFrame(animateHeart);
        }

        /* =========================================
           4. CARRUSEL
           ========================================= */
        function crearCarrusel() {
            const container = document.getElementById('carousel');
            if(container.children.length > 0) return;
            const angleStep = 360/FOTOS.length;
            FOTOS.forEach((src, i) => {
                const div = document.createElement('div');
                div.className = 'foto-card';
                div.style.transform = `rotateY(${i*angleStep}deg) translateZ(300px)`;
                div.innerHTML = `<img src="${src}">`;
                container.appendChild(div);
            });
        }

        /* INIT */
        let tIdx=0, cIdx=0, isDel=false;
        function typeWriter() {
            const txt = FRASES[tIdx];
            const el = document.getElementById('maquina-escribir');
            el.innerText = isDel ? txt.substring(0, cIdx--) : txt.substring(0, cIdx++);
            let spd = isDel ? 50 : 100;
            if(!isDel && cIdx === txt.length+1) { spd = 2000; isDel = true; }
            else if(isDel && cIdx === 0) { isDel = false; tIdx = (tIdx+1)%FRASES.length; spd = 500; }
            setTimeout(typeWriter, spd);
        }
        window.onload = () => { initStars(); animateStars(); typeWriter(); };
        window.addEventListener('resize', () => { initStars(); initHeart(); });
    </script>
</body>
</html>
