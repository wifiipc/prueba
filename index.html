<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para ti ‚ù§Ô∏è</title>
    <style>
        /* --- FUENTES --- */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Dancing+Script:wght@700&family=Pacifico&display=swap');

        /* --- ESTILOS GENERALES --- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Montserrat', sans-serif;
            color: white;
            height: 100vh;
            width: 100vw;
            perspective: 1000px;
        }

        /* --- BOTONES --- */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .btn-glass {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 30px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
            font-size: 0.9rem;
        }
        
        .btn-glass:hover {
            background: #ff4d6d;
            border-color: #ff4d6d;
            box-shadow: 0 0 20px #ff4d6d;
            transform: scale(1.05);
        }

        /* --- ESCENAS --- */
        .escena {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease, transform 1s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: scale(1.2);
        }

        .activa {
            opacity: 1;
            pointer-events: all;
            transform: scale(1);
        }

        /* --- ESCENA 1: UNIVERSO --- */
        #universo { background: black; }
        #starCanvas { position: absolute; z-index: 1; }
        #contenido-texto {
            position: relative;
            z-index: 10;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: #ff4d6d;
            text-shadow: 0 0 20px #ff4d6d;
            margin: 0;
        }
        #maquina-escribir {
            font-size: 1.5rem;
            color: #eee;
            min-height: 1.5em;
        }

        /* --- ESCENA 2: CAMPO DE FLORES (NUEVO) --- */
        #jardin {
            /* Fondo cielo y pradera */
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 60%, #90EE90 70%, #228B22 100%); 
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* Contenedor para las flores generadas */
        #flower-field {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%; /* Ocupan la parte baja */
            z-index: 2;
            pointer-events: none;
        }

        /* Estilos de las flores CSS */
        .css-flower {
            position: absolute;
            bottom: 0;
            transform-origin: bottom center;
            animation: sway 3s ease-in-out infinite alternate;
        }

        .flower-head {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            /* El color se define en JS */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
            position: relative;
            z-index: 2;
        }
        
        /* Centro de la flor */
        .flower-head::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 10px; height: 10px;
            background: yellow;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .flower-stem {
            width: 4px;
            background: linear-gradient(to top, #1a491a, #228B22);
            margin: 0 auto;
            /* La altura se define en JS */
            position: relative;
            top: -2px;
            z-index: 1;
            border-radius: 2px;
        }

        .mensaje-arbol {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            font-family: 'Pacifico', cursive;
            font-size: 1.8rem;
            color: #ff006e;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
            opacity: 0;
            animation: aparecer 2s ease-in 1s forwards; 
            width: 90%;
            max-width: 600px;
        }

        /* --- ESCENA 3: CORAZ√ìN 3D --- */
        #corazon-scene {
            background: radial-gradient(circle, #1a0b14 0%, #000000 100%);
            flex-direction: column;
            overflow: hidden;
        }
        #heartCanvas { position: absolute; z-index: 1; }
        .titulo-flotante {
            position: absolute;
            top: 15%;
            font-family: 'Pacifico', cursive;
            font-size: 3rem;
            color: #ff99ac;
            text-shadow: 0 0 20px #ff006e;
            z-index: 10;
            animation: flotar 3s ease-in-out infinite;
        }

        /* --- ESCENA 4: CARRUSEL --- */
        #galeria {
            background: #000;
            overflow: hidden;
        }
        .carousel-container {
            position: relative;
            width: 200px;
            height: 300px;
            transform-style: preserve-3d;
            animation: rotarCarrusel 20s infinite linear;
        }
        .carousel-container:hover { animation-play-state: paused; }
        .foto-card {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.1);
            border: 2px solid #ff4d6d;
            border-radius: 10px;
            overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(255, 77, 109, 0.5);
        }
        .foto-card img { width: 100%; height: 100%; object-fit: cover; }

        /* ANIMACIONES */
        @keyframes rotarCarrusel { from { transform: perspective(1000px) rotateY(0deg); } to { transform: perspective(1000px) rotateY(360deg); } }
        @keyframes flotar { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes aparecer { from { opacity: 0; transform: translateY(20px) translateX(-50%); } to { opacity: 1; transform: translateY(0) translateX(-50%); } }
        .cursor { display: inline-block; width: 2px; height: 1.2em; background: white; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        /* Animaci√≥n de balanceo para las flores */
        @keyframes sway {
            0% { transform: rotate(-5deg); }
            100% { transform: rotate(5deg); }
        }

    </style>
</head>
<body>

    <div class="controls">
        <button id="btn-music" class="btn-glass" onclick="toggleMusic()">üéµ M√∫sica</button>
        <button id="btn-next" class="btn-glass" onclick="siguienteEscena()">Siguiente ‚ú®</button>
    </div>

    <audio id="bg-music" loop>
        <source src="tu_cancion.mp3" type="audio/mpeg">
    </audio>

    <div id="universo" class="escena activa">
        <canvas id="starCanvas"></canvas>
        <div id="contenido-texto">
            <h1>Para mi Amor</h1>
            <div><span id="maquina-escribir"></span><span class="cursor"></span></div>
        </div>
    </div>

    <div id="jardin" class="escena">
        <div id="flower-field"></div>

        <div class="mensaje-arbol">
            En el jard√≠n de mi vida,<br>
            t√∫ eres la flor m√°s bella,<br>
            la luz que mi alma gu√≠a,<br>
            mi m√°s brillante estrella.
        </div>
    </div>

    <div id="corazon-scene" class="escena">
        <div class="titulo-flotante">Eres mi Todo</div>
        <canvas id="heartCanvas"></canvas>
    </div>

    <div id="galeria" class="escena">
        <div class="titulo-flotante" style="top: 10%; font-size: 2.5rem;">Nuestros Recuerdos</div>
        <div class="carousel-container" id="carousel">
            </div>
    </div>

    <script>
        /* =========================================
           CONFIGURACI√ìN
           ========================================= */
        const FRASES = ["Eres mi universo.", "Mi casualidad favorita.", "Te amo infinito."];
        const FOTOS = [
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+1",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+2",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+3",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+4",
            "https://via.placeholder.com/200x300/ff4d6d/fff?text=Foto+5"
        ];

        let escenaActual = 0;
        const escenasIds = ['universo', 'jardin', 'corazon-scene', 'galeria'];

        function siguienteEscena() {
            document.getElementById(escenasIds[escenaActual]).classList.remove('activa');
            escenaActual = (escenaActual + 1) % escenasIds.length;
            const nueva = document.getElementById(escenasIds[escenaActual]);
            nueva.classList.add('activa');
            
            // Iniciar animaciones seg√∫n escena
            if(escenaActual === 0) { initStars(); animateStars(); }
            else if(escenaActual === 1) { initFlowers(); } // Inicia el campo de flores
            else if(escenaActual === 2) { initHeart(); animateHeart(); }
            else { crearCarrusel(); }
        }

        function toggleMusic() {
            const audio = document.getElementById('bg-music');
            audio.paused ? audio.play() : audio.pause();
        }

        /* =========================================
           1. UNIVERSO
           ========================================= */
        const starCanvas = document.getElementById('starCanvas');
        const sCtx = starCanvas.getContext('2d');
        let stars = [];

        function initStars() {
            starCanvas.width = window.innerWidth; starCanvas.height = window.innerHeight;
            stars = [];
            for(let i=0; i<300; i++) stars.push({x:Math.random()*starCanvas.width, y:Math.random()*starCanvas.height, z:Math.random()*starCanvas.width});
        }
        function animateStars() {
            if(!document.getElementById('universo').classList.contains('activa')) return;
            sCtx.fillStyle = "black"; sCtx.fillRect(0,0,starCanvas.width, starCanvas.height);
            sCtx.fillStyle = "white";
            stars.forEach(s => {
                s.z -= 2; if(s.z <= 0) s.z = starCanvas.width;
                let x = (s.x-starCanvas.width/2)*(starCanvas.width/s.z)+starCanvas.width/2;
                let y = (s.y-starCanvas.height/2)*(starCanvas.width/s.z)+starCanvas.height/2;
                if(x>0 && x<starCanvas.width && y>0 && y<starCanvas.height) { sCtx.beginPath(); sCtx.arc(x,y,(1-s.z/starCanvas.width)*3,0,Math.PI*2); sCtx.fill(); }
            });
            requestAnimationFrame(animateStars);
        }

        /* =========================================
           2. CAMPO DE FLORES (NUEVO SISTEMA CSS/JS)
           ========================================= */
        function initFlowers() {
            const container = document.getElementById('flower-field');
            // Si ya hay flores, no hacemos nada
            if (container.children.length > 0) return;

            const colors = [
                'radial-gradient(circle, #ff99ac, #ff006e)', // Rosa
                'radial-gradient(circle, #ffccd5, #e63946)', // Rojo claro
                'radial-gradient(circle, #e0aaff, #7b2cbf)', // P√∫rpura
                'radial-gradient(circle, #ffea00, #ff7b00)'  // Naranja/Amarillo
            ];

            // Crear 50 flores
            for (let i = 0; i < 60; i++) {
                createFlower(container, colors);
            }
        }

        function createFlower(container, colors) {
            const flower = document.createElement('div');
            flower.className = 'css-flower';
            
            // Posici√≥n aleatoria horizontal
            flower.style.left = `${Math.random() * 100}%`;
            
            // Tama√±o aleatorio
            const scale = 0.5 + Math.random() * 0.8;
            flower.style.transform = `scale(${scale})`;
            
            // Retraso de animaci√≥n aleatorio para que no se muevan igual
            flower.style.animationDelay = `${Math.random() * -5}s`;
            flower.style.animationDuration = `${3 + Math.random() * 3}s`;

            // Altura del tallo aleatoria
            const stemHeight = 60 + Math.random() * 100;

            // Color aleatorio
            const color = colors[Math.floor(Math.random() * colors.length)];

            // Crear estructura HTML de la flor
            flower.innerHTML = `
                <div class="flower-head" style="background: ${color}"></div>
                <div class="flower-stem" style="height: ${stemHeight}px"></div>
            `;

            container.appendChild(flower);
        }

        /* =========================================
           3. CORAZ√ìN 3D
           ========================================= */
        const hCanvas = document.getElementById('heartCanvas');
        const hCtx = hCanvas.getContext('2d');
        let hPoints = []; let angleY = 0;

        function initHeart() {
            hCanvas.width = window.innerWidth; hCanvas.height = window.innerHeight;
            hPoints = [];
            for(let i=0; i<1500; i++) {
                let t = Math.random()*Math.PI*2, x = 16*Math.pow(Math.sin(t),3), y = -(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
                let z = (Math.random()-0.5)*10;
                hPoints.push({x:x*12, y:y*12, z:z*12, color: `hsl(${330+Math.random()*40}, 90%, 60%)`});
            }
        }
        function animateHeart() {
            if(!document.getElementById('corazon-scene').classList.contains('activa')) return;
            hCtx.fillStyle = "rgba(0,0,0,0.2)"; hCtx.fillRect(0,0,hCanvas.width, hCanvas.height);
            angleY += 0.01;
            let cx = hCanvas.width/2, cy = hCanvas.height/2;
            hPoints.forEach(p => {
                let rx = p.x*Math.cos(angleY) - p.z*Math.sin(angleY);
                let rz = p.x*Math.sin(angleY) + p.z*Math.cos(angleY);
                let scale = 500/(500+rz);
                if(scale>0) {
                    hCtx.fillStyle = p.color; hCtx.beginPath(); hCtx.arc(rx*scale+cx, p.y*scale+cy, 2*scale, 0, Math.PI*2); hCtx.fill();
                }
            });
            requestAnimationFrame(animateHeart);
        }

        /* =========================================
           4. CARRUSEL
           ========================================= */
        function crearCarrusel() {
            const container = document.getElementById('carousel');
            if(container.children.length > 0) return;
            const angleStep = 360/FOTOS.length;
            FOTOS.forEach((src, i) => {
                const div = document.createElement('div');
                div.className = 'foto-card';
                div.style.transform = `rotateY(${i*angleStep}deg) translateZ(300px)`;
                div.innerHTML = `<img src="${src}">`;
                container.appendChild(div);
            });
        }

        /* INIT */
        let tIdx=0, cIdx=0, isDel=false;
        function typeWriter() {
            const txt = FRASES[tIdx];
            const el = document.getElementById('maquina-escribir');
            el.innerText = isDel ? txt.substring(0, cIdx--) : txt.substring(0, cIdx++);
            let spd = isDel ? 50 : 100;
            if(!isDel && cIdx === txt.length+1) { spd = 2000; isDel = true; }
            else if(isDel && cIdx === 0) { isDel = false; tIdx = (tIdx+1)%FRASES.length; spd = 500; }
            setTimeout(typeWriter, spd);
        }
        window.onload = () => { initStars(); animateStars(); typeWriter(); };
        window.addEventListener('resize', () => { initStars(); initHeart(); });
    </script>
</body>
</html>

