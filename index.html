<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Para ti ❤️</title>
    <!-- Preload fonts for speed -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;700&family=Dancing+Script:wght@700&family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- VARIABLES & RESET --- */
        :root {
            --dark-bg: #050510;
            --accent: #ff2a6d;
            --secondary: #05d9e8;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-glow: 0 0 10px rgba(255, 42, 109, 0.5);
            --font-main: 'Montserrat', sans-serif;
            --font-love: 'Dancing Script', cursive;
        }

        *, *::after, *::before {
            padding: 0; margin: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: var(--font-main);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            user-select: none;
            -webkit-user-select: none;
            /* Gradient background base */
            background: linear-gradient(to bottom, #020111 0%, #191621 100%);
        }

        /* --- UTILITIES --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #ff5c8a);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(255, 42, 109, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            letter-spacing: 0.5px;
        }

        .btn-primary:active { transform: scale(0.96); box-shadow: 0 2px 8px rgba(255, 42, 109, 0.3); }

        .hidden { display: none !important; }
        .fade-out { opacity: 0; pointer-events: none; transition: opacity 0.8s ease; }
        .fade-in { opacity: 1; pointer-events: all; }

        /* --- LOCK SCREEN --- */
        #lock-screen {
            position: fixed; inset: 0; z-index: 50000;
            background: center/cover no-repeat url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?ixlib=rb-4.0.3&auto=format&fit=crop&w=1080&q=80');
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            padding-top: 15vh;
            color: white;
            text-align: center;
        }
        #lock-screen::before {
            content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.4); z-index: -1;
        }
        .lock-time { font-size: 5rem; font-weight: 300; line-height: 1; margin-bottom: 10px; }
        .lock-date { font-size: 1.2rem; font-weight: 500; margin-bottom: 40px; }
        
        .unlock-container {
            margin-top: auto; margin-bottom: 10vh;
            width: 90%; max-width: 320px;
        }
        .passcode-title { margin-bottom: 15px; font-size: 0.9rem; opacity: 0.8; letter-spacing: 1px; }
        
        /* Modern Select Inputs */
        .date-picker {
            display: flex; gap: 8px; justify-content: center;
        }
        .custom-select-wrapper { 
            position: relative; flex: 1;
        }
        select {
            width: 100%;
            appearance: none; -webkit-appearance: none;
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 1rem;
            outline: none;
            font-family: var(--font-main);
        }
        .error-shake { animation: shake 0.4s ease-in-out; border-color: #ff4d4d !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-8px); } 40%, 80% { transform: translateX(8px); } }

        /* --- MAIN APP CONTAINER --- */
        #app-container {
            position: fixed; inset: 0;
            opacity: 0; transition: opacity 1s ease;
            overflow: hidden;
        }

        /* --- SCENES --- */
        .scene {
            position: absolute; inset: 0;
            opacity: 0; pointer-events: none;
            transition: opacity 0.8s ease, transform 0.8s ease;
            transform: scale(1.05);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
        }
        .scene.active { opacity: 1; pointer-events: all; transform: scale(1); }

        /* SCENE 1: UNIVERSE */
        #scene-universe { background: radial-gradient(circle at bottom, #1b2735 0%, #090a0f 100%); }
        #stars-canvas { position: absolute; inset: 0; }
        .title-wrapper {
            position: relative; z-index: 10; text-align: center;
        }
        .main-title {
            font-family: var(--font-love);
            font-size: 4.5rem;
            background: linear-gradient(to right, var(--accent), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            filter: drop-shadow(0 0 15px rgba(255, 42, 109, 0.4));
        }
        .typing-text {
            font-size: 1.2rem; letter-spacing: 2px;
            min-height: 24px; display: inline-block;
        }
        .cursor { display: inline-block; width: 2px; height: 1.2em; background: var(--secondary); vertical-align: bottom; animation: blink 1s infinite; margin-left: 4px; }
        @keyframes blink { 50% { opacity: 0; } }

        /* SCENE 2: GARDEN */
        #scene-garden { background: linear-gradient(to top, #000000 0%, #0f2027 100%); }
        .fireflies { position: absolute; inset: 0; pointer-events: none; }
        .firefly { 
            position: absolute; width: 4px; height: 4px; background: #ffff00; 
            box-shadow: 0 0 10px #ffff00; border-radius: 50%;
            animation: fly 10s infinite linear; opacity: 0;
        }
        @keyframes fly { 
            0% { transform: translate(0,0); opacity: 0; } 
            10% { opacity: 1; } 
            90% { opacity: 1; } 
            100% { transform: translate(var(--mx), var(--my)); opacity: 0; } 
        }
        .poem-card {
            padding: 30px; text-align: center;
            max-width: 85%;
            margin-bottom: 100px; /* Space for flowers */
        }
        .days-counter {
            font-size: 0.9rem; color: var(--secondary); margin-top: 15px; text-transform: uppercase; letter-spacing: 1px;
        }
        /* CSS Flowers Container - Scaled for mobile */
        .flowers-wrapper-css {
            position: absolute; bottom: 0; width: 100%; height: 35vh;
            pointer-events: none; z-index: 5;
        }

        /* SCENE 3: HEART */
        #scene-heart { background: black; }
        .heart-overlay-text {
            position: absolute; top: 15%; width: 100%; text-align: center;
            font-family: var(--font-love); font-size: 3rem; color: var(--accent);
            text-shadow: 0 0 20px rgba(255, 42, 109, 0.6);
            z-index: 10; pointer-events: none;
        }

        /* SCENE 4: GALLERY */
        #scene-gallery { 
            background: #111; 
            perspective: 1000px;
        }
        .gallery-title {
            position: absolute; top: 10%; width: 100%; text-align: center;
            font-family: var(--font-love); font-size: 3rem; color: white;
            z-index: 10;
        }
        /* 3D Carousel */
        .carousel {
            position: relative; width: 240px; height: 320px;
            transform-style: preserve-3d;
            transition: transform 0.5s ease-out;
            cursor: grab;
        }
        .carousel-item {
            position: absolute; inset: 0;
            border-radius: 15px;
            background-size: cover; background-position: center;
            border: 3px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            /* Backface visibility hidden for performance */
            /* -webkit-backface-visibility: hidden; backface-visibility: hidden; */
        }
        .carousel-item::after {
            content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 40%);
            border-radius: 12px;
        }
        .photo-caption {
            position: absolute; bottom: 20px; left: 15px; right: 15px;
            color: white; font-size: 0.9rem; font-weight: 500;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            opacity: 0; transform: translateY(10px); transition: 0.3s;
        }
        .carousel-item.active-card .photo-caption { opacity: 1; transform: translateY(0); }

        /* --- CONTROLS UI --- */
        .ui-layer {
            position: fixed; inset: 0; pointer-events: none; z-index: 10000;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        
        /* Progress line top */
        .progress-line-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: rgba(255,255,255,0.1);
        }
        .progress-line { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s; box-shadow: 0 0 10px var(--accent); }

        /* Bottom Controls (Music & Nav) */
        .bottom-shelf {
            margin-top: auto; width: 100%;
            padding: 20px; padding-bottom: calc(20px + env(safe-area-inset-bottom));
            pointer-events: all;
            display: flex; flex-direction: column; gap: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }

        /* Music Player Styled like Spotify */
        .player-pill {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }
        .track-info { display: flex; align-items: center; gap: 12px; overflow: hidden; flex: 1; }
        .album-art { 
            width: 40px; height: 40px; background: #333; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
            background-size: cover; background-position: center;
        }
        .track-text { display: flex; flex-direction: column; min-width: 0; }
        .track-name { font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .artist-name { font-size: 0.75rem; color: #aaa; }
        
        .player-buttons { display: flex; align-items: center; gap: 15px; margin-left: 10px; }
        .control-icon { font-size: 1.2rem; color: white; opacity: 0.9; }
        .play-pause-btn { 
            width: 32px; height: 32px; background: white; color: black; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1rem;
        }

        /* Nav Button */
        .nav-btn-container { display: flex; justify-content: flex-end; }
        .next-btn {
            background: var(--glass); backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 12px 24px; border-radius: 30px;
            font-weight: 600; display: flex; align-items: center; gap: 8px;
            transition: 0.2s;
        }
        .next-btn:active { background: rgba(255,255,255,0.2); }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; inset: 0; z-index: 60000;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-content { width: 90%; max-width: 400px; }

        /* Playlist Modal */
        .playlist-track {
            display: flex; align-items: center; gap: 15px;
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: background 0.2s;
        }
        .playlist-track:active { background: rgba(255,255,255,0.05); }
        
        /* Floating hearts animation */
        .floating-heart {
            position: fixed; font-size: 1.5rem; pointer-events: none; z-index: 9999;
            animation: floatUp 2s ease-out forwards;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 1; }
            100% { transform: translateY(-100vh) scale(1.2); opacity: 0; }
        }

    </style>
</head>
<body>

    <!-- LOCK SCREEN -->
    <div id="lock-screen">
        <div class="lock-time" id="lock-time">00:00</div>
        <div class="lock-date" id="lock-date">Sábado, 14 Febrero</div>
        
        <div class="unlock-container glass-panel" style="padding: 20px;">
            <div class="passcode-title">Introduce la fecha de la bolera y nuestro primer beso</div>
            <div class="date-picker">
                <div class="custom-select-wrapper"><select id="day-select"><option value="" disabled selected>Día</option></select></div>
                <div class="custom-select-wrapper"><select id="month-select"><option value="" disabled selected>Mes</option></select></div>
                <div class="custom-select-wrapper"><select id="year-select"><option value="" disabled selected>Año</option></select></div>
            </div>
            <button class="btn-primary" style="margin-top: 20px; width: 100%;" onclick="attemptUnlock()">Desbloquear <i class="fas fa-lock-open"></i></button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-container">
        
        <!-- UI OVERLAY -->
        <div class="ui-layer">
            <div class="progress-line-container"><div class="progress-line" id="scene-progress"></div></div>
            
            <div class="bottom-shelf">
                <!-- Music Player -->
                <div class="player-pill" onclick="openPlaylist()">
                    <div class="track-info">
                        <div class="album-art" id="player-art"><i class="fas fa-music"></i></div>
                        <div class="track-text">
                            <div class="track-name" id="player-title">Elige una canción</div>
                            <div class="artist-name" id="player-artist">Toca para abrir</div>
                        </div>
                    </div>
                    <div class="player-buttons">
                        <i class="control-icon fas fa-backward" onclick="event.stopPropagation(); prevSong()"></i>
                        <div class="play-pause-btn" onclick="event.stopPropagation(); togglePlay()">
                            <i class="fas fa-play" id="play-icon"></i>
                        </div>
                        <i class="control-icon fas fa-forward" onclick="event.stopPropagation(); nextSong()"></i>
                    </div>
                </div>

                <!-- Next Button -->
                <div class="nav-btn-container">
                    <button class="next-btn" onclick="nextScene()">
                        Siguiente <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- SCENE 1: UNIVERSE -->
        <div id="scene-universe" class="scene active">
            <canvas id="stars-canvas"></canvas>
            <div class="title-wrapper p-4 glass-panel">
                <h1 class="main-title">Para mi Amor</h1>
                <div>
                    <span class="typing-text" id="typing-container"></span><span class="cursor"></span>
                </div>
            </div>
        </div>

        <!-- SCENE 2: GARDEN -->
        <div id="scene-garden" class="scene">
            <div class="fireflies" id="fireflies-container"></div>
            <div class="poem-card glass-panel">
                <h2 style="font-family: var(--font-love); font-size: 2.2rem; color: var(--accent); margin-bottom: 10px;">Juntos...</h2>
                <p style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 20px;">
                    "Bajo este cielo de luces infinitas,<br>mi corazón florece solo para ti."
                </p>
                <div class="days-counter" id="days-counter">Calculando...</div>
            </div>
            <!-- Flowers are injected via JS or SVG background to save CSS lines -->
            <div class="flowers-wrapper-css" id="flower-garden"></div>
        </div>

        <!-- SCENE 3: HEART -->
        <div id="scene-heart" class="scene">
            <div class="heart-overlay-text">Eres mi Todo</div>
            <canvas id="heart-canvas"></canvas>
        </div>

        <!-- SCENE 4: GALLERY -->
        <div id="scene-gallery" class="scene">
            <div class="gallery-title">Nuestros Recuerdos</div>
            <div class="carousel" id="carousel">
                <!-- Generated by JS -->
            </div>
            <p style="position:absolute; bottom: 15vh; opacity: 0.6; font-size: 0.8rem;">Desliza para girar</p>
        </div>

    </div>

    <!-- PLAYLIST MODAL -->
    <div id="playlist-modal" class="modal-overlay">
        <div class="modal-content glass-panel" style="background: rgba(10,10,10,0.95);">
            <div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between;">
                <h3>Playlist ❤️</h3>
                <i class="fas fa-times" style="font-size: 1.2rem; cursor: pointer;" onclick="closePlaylist()"></i>
            </div>
            <div id="playlist-tracks" style="max-height: 50vh; overflow-y: auto;"></div>
        </div>
    </div>

    <audio id="bg-music"></audio>

    <script>
        /* --- CONFIGURATION --- */
        const CONFIG = {
            startDate: "2025-10-25T00:00:00",
            passcode: { day: 25, month: 10, year: 2025 },
            phrases: ["Eres mi universo.", "Mi casualidad favorita.", "Te amo infinito."],
            gallery: [
                { url: "https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?w=500&q=80", desc: "Todo empezó aquí..." },
                { url: "https://images.unsplash.com/photo-1474552226712-ac0f0961a954?w=500&q=80", desc: "Nuestro primer viaje" },
                { url: "https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=500&q=80", desc: "Contigo todo es mejor" },
                { url: "https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?w=500&q=80", desc: "Esos momentos únicos" }
            ],
            playlist: [
                { title: "Huracán", artist: "Funzo & BabyLoud", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" }, // Placeholder URL
                { title: "Yellow", artist: "Coldplay", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
                { title: "Lo que pido", artist: "DePol", src: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
            ]
        };

        /* --- STATE --- */
        let state = {
            scene: 0,
            songIndex: 0,
            isPlaying: false,
            carouselAngle: 0
        };

        const scenes = ['scene-universe', 'scene-garden', 'scene-heart', 'scene-gallery'];
        const audio = document.getElementById('bg-music');

        /* --- INIT --- */
        window.onload = () => {
            initLockScreen();
            startClock();
            generateFlowers();
        };

        /* --- LOCK SCREEN --- */
        function initLockScreen() {
            const days = document.getElementById('day-select');
            const months = document.getElementById('month-select');
            const years = document.getElementById('year-select');

            // Populate Lock Screen options
            for(let i=1; i<=31; i++) days.add(new Option(i, i));
            const monthNames = ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"];
            monthNames.forEach((m, i) => months.add(new Option(m, i+1)));
            [2024, 2025, 2026].forEach(y => years.add(new Option(y, y)));
        }

        function startClock() {
            const updateClock = () => {
                const now = new Date();
                document.getElementById('lock-time').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                document.getElementById('lock-date').innerText = now.toLocaleDateString('es-ES', {weekday: 'long', day: 'numeric', month: 'long'});
            };
            setInterval(updateClock, 1000);
            updateClock();
        }

        function attemptUnlock() {
            const d = parseInt(document.getElementById('day-select').value);
            const m = parseInt(document.getElementById('month-select').value);
            const y = parseInt(document.getElementById('year-select').value);
            
            // Logic check
            if (d == CONFIG.passcode.day && m == CONFIG.passcode.month && y == CONFIG.passcode.year) {
                // Success
                navigator.vibrate?.(50);
                document.getElementById('lock-screen').classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById('lock-screen').classList.add('hidden');
                    document.getElementById('app-container').style.opacity = '1';
                    startApp();
                }, 800);
            } else {
                // Fail
                navigator.vibrate?.([50, 50, 50]);
                document.querySelector('.unlock-container').classList.add('error-shake');
                setTimeout(() => document.querySelector('.unlock-container').classList.remove('error-shake'), 500);
            }
        }

        function startApp() {
            // Start Universe
            initStars();
            typeWriter();
            // Load Music but don't play yet
            loadSong(0);
        }

        /* --- NAVIGATION --- */
        function nextScene() {
            navigator.vibrate?.(20);
            
            // Hide current
            document.getElementById(scenes[state.scene]).classList.remove('active');
            
            // Advance
            state.scene = (state.scene + 1) % scenes.length;
            
            // Show new
            const newScene = document.getElementById(scenes[state.scene]);
            newScene.classList.add('active');
            
            // Update progress
            document.getElementById('scene-progress').style.width = `${(state.scene / (scenes.length-1)) * 100}%`;

            // Init scene specific logic
            if(state.scene === 1) initGarden();
            if(state.scene === 2) initHeart();
            if(state.scene === 3) initGallery();
        }

        /* --- SCENE 1: UNIVERSE LOGIC --- */
        function initStars() {
            const canvas = document.getElementById('stars-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const stars = Array.from({length: 200}, () => ({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                z: Math.random() * 2, // Depth
                alpha: Math.random()
            }));

            function animate() {
                if(!document.getElementById(scenes[0]).classList.contains('active')) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "white";
                
                stars.forEach(s => {
                    s.y -= s.z * 0.5; // Move up
                    if(s.y < 0) s.y = canvas.height;
                    
                    ctx.globalAlpha = s.alpha;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.z, 0, Math.PI*2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            animate();
        }

        let typeIndex = 0;
        let charIndex = 0;
        let isDeleting = false;
        function typeWriter() {
            const currentText = CONFIG.phrases[typeIndex];
            const container = document.getElementById('typing-container');
            
            if(isDeleting) {
                container.innerText = currentText.substring(0, charIndex--);
            } else {
                container.innerText = currentText.substring(0, charIndex++);
            }

            let speed = isDeleting ? 50 : 100;

            if(!isDeleting && charIndex === currentText.length + 1) {
                speed = 2000; // Pause at end
                isDeleting = true;
            } else if(isDeleting && charIndex === 0) {
                isDeleting = false;
                typeIndex = (typeIndex + 1) % CONFIG.phrases.length;
                speed = 500;
            }
            
            setTimeout(typeWriter, speed);
        }

        /* --- SCENE 2: GARDEN --- */
        function initGarden() {
            // Update counter
            const start = new Date(CONFIG.startDate);
            const now = new Date();
            const days = Math.floor((now - start) / (1000 * 60 * 60 * 24));
            document.getElementById('days-counter').innerText = `Juntos desde el 25 Oct 2025 (${days} días)`;
            
            // Init fireflies
            const container = document.getElementById('fireflies-container');
            container.innerHTML = '';
            for(let i=0; i<20; i++) {
                const f = document.createElement('div');
                f.className = 'firefly';
                f.style.left = Math.random() * 100 + '%';
                f.style.top = Math.random() * 100 + '%';
                f.style.setProperty('--mx', (Math.random()*200 - 100) + 'px');
                f.style.setProperty('--my', (Math.random()*200 - 100) + 'px');
                f.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(f);
            }
        }
        
        function generateFlowers() {
            // Just simple SVG placeholders for cleaner code than huge CSS
            const garden = document.getElementById('flower-garden');
            const flowerSVGs = [
                '<svg viewBox="0 0 100 100" style="fill:#ff4d6d; width:50px;"><path d="M50 50 Q30 20 50 0 Q70 20 50 50" /><path d="M50 50 Q80 30 100 50 Q80 70 50 50" /><path d="M50 50 Q70 80 50 100 Q30 80 50 50" /><path d="M50 50 Q20 70 0 50 Q20 30 50 50" /><circle cx="50" cy="50" r="10" fill="#ffeb3b"/></svg>',
                '<svg viewBox="0 0 100 100" style="fill:#05d9e8; width:40px;"><circle cx="30" cy="30" r="20"/><circle cx="70" cy="30" r="20"/><circle cx="30" cy="70" r="20"/><circle cx="70" cy="70" r="20"/><circle cx="50" cy="50" r="15" fill="#fff"/></svg>'
            ];
            
            for(let i=0; i<15; i++) {
                const el = document.createElement('div');
                el.style.position = 'absolute';
                el.style.bottom = (Math.random() * 10) + '%';
                el.style.left = (Math.random() * 90) + '%';
                el.innerHTML = flowerSVGs[i % 2];
                // Initial animation
                el.style.transformOrigin = 'bottom center';
                el.style.transform = `scale(${0.5 + Math.random()})`;
                el.style.animation = `sway ${2+Math.random()}s infinite ease-in-out alternate`;
                garden.appendChild(el);
            }
            const style = document.createElement('style');
            style.innerHTML = `@keyframes sway { from{transform:rotate(-5deg) scale(var(--s,1));} to{transform:rotate(5deg) scale(var(--s,1));} }`;
            document.head.appendChild(style);
        }

        /* --- SCENE 3: HEART --- */
        function initHeart() {
            const canvas = document.getElementById('heart-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            let particles = [];
            const particleCount = window.innerWidth < 600 ? 500 : 1000;
            
            for(let i=0; i<particleCount; i++) {
                particles.push({
                    t: Math.random() * Math.PI * 2,
                    z: Math.random(),
                    speed: 0.005 + Math.random() * 0.01
                });
            }

            function heartFunc(t) {
                return {
                    x: 16 * Math.pow(Math.sin(t), 3),
                    y: -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t))
                };
            }

            function animate() {
                if(!document.getElementById(scenes[2]).classList.contains('active')) return;
                ctx.fillStyle = "rgba(0,0,0,0.1)"; // Trails
                ctx.fillRect(0,0,canvas.width, canvas.height);
                
                const cx = canvas.width/2;
                const cy = canvas.height/2;
                const scale = Math.min(canvas.width, canvas.height) / 40;

                particles.forEach(p => {
                    p.t += p.speed;
                    const pos = heartFunc(p.t);
                    
                    // Add some noise
                    const noise = (Math.random() - 0.5) * 5;
                    
                    ctx.fillStyle = `hsl(${330 + Math.random()*30}, 80%, 60%)`;
                    ctx.beginPath();
                    ctx.arc(cx + pos.x * scale + noise, cy + pos.y * scale + noise, 1.5, 0, Math.PI*2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            animate();
            
            // Add click interaction
            canvas.onclick = (e) => {
                createFloatingHeart(e.clientX, e.clientY);
                navigator.vibrate?.(50);
            };
        }
        
        function createFloatingHeart(x, y) {
            const h = document.createElement('div');
            h.innerHTML = '❤️';
            h.className = 'floating-heart';
            h.style.left = x + 'px';
            h.style.top = y + 'px';
            document.body.appendChild(h);
            setTimeout(() => h.remove(), 2000);
        }

        /* --- SCENE 4: GALLERY --- */
        let touchStartX = 0;
        let currentAngle = 0;
        
        function initGallery() {
            const container = document.getElementById('carousel');
            if(container.children.length > 0) return; // Already built
            
            const radius = Math.round( (240 / 2) / Math.tan(Math.PI / CONFIG.gallery.length) );
            // Adjust radius slightly for spacing
            const finalRadius = radius + 80;

            CONFIG.gallery.forEach((item, i) => {
                const el = document.createElement('div');
                el.className = 'carousel-item';
                // Calculate position
                const theta = (360 / CONFIG.gallery.length) * i;
                el.style.transform = `rotateY(${theta}deg) translateZ(${finalRadius}px)`;
                el.style.backgroundImage = `url(${item.url})`;
                
                const cap = document.createElement('div');
                cap.className = 'photo-caption';
                cap.innerText = item.desc;
                el.appendChild(cap);
                
                container.appendChild(el);
            });
            
            // Touch Events
            const scene = document.getElementById('scene-gallery');
            scene.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; });
            scene.addEventListener('touchmove', e => {
                const touchX = e.touches[0].clientX;
                const delta = touchStartX - touchX;
                // Sensitvity
                container.style.transform = `rotateY(${currentAngle - delta * 0.5}deg)`;
            });
            scene.addEventListener('touchend', e => {
                const touchEndX = e.changedTouches[0].clientX;
                const delta = touchStartX - touchEndX;
                currentAngle -= delta * 0.5;
                container.style.transform = `rotateY(${currentAngle}deg)`;
            });
        }

        /* --- MUSIC --- */
        function loadSong(index) {
            state.songIndex = index;
            const song = CONFIG.playlist[index];
            document.getElementById('player-title').innerText = song.title;
            document.getElementById('player-artist').innerText = song.artist;
            // Fake Art color
            document.getElementById('player-art').style.backgroundColor = `hsl(${Math.random()*360}, 60%, 40%)`;
            
            audio.src = song.src;
            if(state.isPlaying) audio.play();
        }

        function togglePlay() {
            if(audio.paused) {
                audio.play().catch(e => alert("Interactúa primero"));
                document.getElementById('play-icon').classList.replace('fa-play', 'fa-pause');
                state.isPlaying = true;
            } else {
                audio.pause();
                document.getElementById('play-icon').classList.replace('fa-pause', 'fa-play');
                state.isPlaying = false;
            }
        }

        function nextSong() { loadSong((state.songIndex + 1) % CONFIG.playlist.length); }
        function prevSong() { loadSong((state.songIndex - 1 + CONFIG.playlist.length) % CONFIG.playlist.length); }

        function openPlaylist() {
            const list = document.getElementById('playlist-tracks');
            list.innerHTML = '';
            CONFIG.playlist.forEach((s, i) => {
                const div = document.createElement('div');
                div.className = 'playlist-track';
                div.innerHTML = `<div>${i+1}</div><div><div style="font-weight:bold">${s.title}</div><div style="font-size:0.8rem;opacity:0.7">${s.artist}</div></div>`;
                div.onclick = () => { loadSong(i); togglePlay(); closePlaylist(); };
                list.appendChild(div);
            });
            document.getElementById('playlist-modal').classList.add('open');
        }
        function closePlaylist() { document.getElementById('playlist-modal').classList.remove('open'); }

    </script>
</body>
</html>




